<div style="width: 100%; margin: auto;">
   <div style="width: 100%; background-color: #014AC5;">
      <form [formGroup]="TestParameter" (ngSubmit)="onSubmitBtn()" noval fxLayout="column" fxFlex="1 1 100"
         class="frmCont panel" style="background-color: #014AC5;">
         <br/>
         <h2 class="pTxt">Laboratory Part</h2>
         <br />
         <div fxLayout="column" fxFlex="1 1 100" class="divBg">
            <div fxFlex="100" fxLayout="column" fxLayout.xs="column" fxLayoutGap="5px" formArrayName="Samples"
               *ngFor="let smpl of TestParameter.controls.Samples.value; let si = index;">
               <div fxFlex="1 1 100" fxLayout="column">
                  <div fxLayout="column" style="padding: 5px;" [formGroupName]="si">
                     <fieldset>
                        <legend>
                           <span>Sample-{{si+1}}</span>
                        </legend>
                        <div fxFlex="1 1 100" fxLayout="column">
                           <div fxFlex="100" fxLayout="column" fxLayout.xs="column" fxLayoutGap="5px">
                              <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                                 <div fxFlex="1 1 15">
                                    <mat-label>Sample ID</mat-label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 83">
                                    <mat-form-field appearance="no" fxFlex="100" class="matFldMarg">
                                       <input matInput formControlName="SampleID" readonly disabled>
                                    </mat-form-field>
                                 </div>
                              </div>
                              <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                                 <div fxFlex="1 1 15">
                                    <mat-label>Sample Description</mat-label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 83">
                                    <mat-form-field appearance="no" fxFlex="100" class="matFldMarg">
                                       <textarea matInput formControlName="SampleDescription" readonly disabled style="resize: none;" ></textarea>
                                    </mat-form-field>
                                 </div>
                              </div>
                              <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                                 <div fxFlex="1 1 15">
                                    <mat-label>Reference No</mat-label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 83">
                                    <mat-form-field appearance="no" fxFlex="100" class="matFldMarg">
                                       <input matInput formControlName="ReferenceNo" readonly disabled>
                                    </mat-form-field>
                                 </div>
                              </div>
                              <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                                 <div fxFlex="1 1 15">
                                    <mat-label>Sample Type</mat-label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 83">
                                    <mat-form-field appearance="no" fxFlex="100" class="matFldMarg">
                                       <input matInput formControlName="SampleType" readonly disabled>
                                    </mat-form-field>
                                 </div>
                              </div>
                              <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                                 <div fxFlex="1 1 15">
                                    <mat-label>Specific Requirement</mat-label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 83">
                                    <mat-form-field appearance="no" fxFlex="100" class="matFldMarg">
                                       <textarea matInput formControlName="SpecificRequirement" readonly disabled style="resize: none;"></textarea>
                                    </mat-form-field>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </fieldset>
                  </div>
               </div>
            </div>
         </div>

 
         <br/>
         <div fxLayout="column" fxFlex="1 1 100" >
            <div fxFlex="1 1 100">
               <div fxLayout="column" fxFlex="1 1 100">
                  <div fxLayout="column" class="divBg">
                     <div fxFlex="1 1 100" fxLayout="column" fxLayoutGap="10px">
                        <div fxFlex="100" fxLayout="column" fxLayout.xs="column" fxLayoutGap="0px">
                           <br/>
                           
                           
                           <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="0px">
                              <div fxFlex="1 1 50" fxLayout="row" fxLayoutAlign="space-between start" wrap="nowrap">
                                 <div fxFlex="1 1 34">
                                    <mat-label>Package Condition</mat-label>
                                    <label style="color:red">*</label>
                                 </div>
                                 <div fxFlex="1 1 2">
                                    <mat-label>:</mat-label>
                                 </div>
                                 <div fxFlex="1 1 64" style="margin-top: -20px;">
                                    
                                    <mat-form-field appearance="outline" >
                                       <mat-select typeaheadDebounceInterval="50000" formControlName="PackageCondition" disableScrollLock="true">
                                          
                                          <mat-optgroup *ngFor="let group of requestForsGroups" [label]="group.name">
                                             <mat-option *ngFor="let requestFor of group.requestFor"
                                                [value]="requestFor.viewValue" class="option-style">
                                                {{requestFor.viewValue}}
                                             </mat-option>
                                          </mat-optgroup>
                                       </mat-select>
                                    </mat-form-field>                                    
                                    
                                 </div>
                              </div>
                              <div fxFlex="1 1 50" fxLayout="row" fxLayoutAlign="space-between start">
                              </div>
                           </div>
                        </div>
                        <br />
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="1px">
                           <div fxFlex="1 1 50" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 34">
                                 <mat-label>Test Period From</mat-label>
                                 <label style="color:red">*</label>
                              </div>
                              <div fxFlex="1 1 2">
                                 <mat-label>:</mat-label>
                              </div>
                              <div fxFlex="1 1 64" style="margin-top: -20px;">
                                 <mat-form-field appearance="outline">
                                    <input matInput [matDatepicker]="TestPeriodFrom" formControlName='TestPeriodFrom'>
                                    <mat-datepicker-toggle matSuffix [for]="TestPeriodFrom"></mat-datepicker-toggle>
                                    <mat-datepicker #TestPeriodFrom disabled="false"></mat-datepicker>
                                 </mat-form-field>
                              </div>
                           </div>
                           <div fxFlex="1 1 50" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 34">
                                 <mat-label>Test Period To</mat-label>
                                 <label style="color:red">*</label>
                              </div>
                              <div fxFlex="1 1 2">
                                 <mat-label>:</mat-label>
                              </div>
                              <div fxFlex="1 1 64" style="margin-top: -20px;">
                                 <mat-form-field appearance="outline">
                                    <input matInput [matDatepicker]="TestPeriodTo" formControlName='TestPeriodTo'>
                                    <mat-datepicker-toggle matSuffix [for]="TestPeriodTo"></mat-datepicker-toggle>
                                    <mat-datepicker #TestPeriodTo disabled="false"></mat-datepicker>
                                 </mat-form-field>
                              </div>
                           </div>
                        </div>
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="1px" class="matFld"
                           style="margin-top: -12px;">
                           <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 17">
                                 <mat-label>Environment/Test Condition</mat-label>
                              </div>
                              <div fxFlex="1 1 1">
                                 <mat-label>:</mat-label>
                              </div>
                              <div fxFlex="1 1 82" style="margin-top: -20px;">
                                 <mat-form-field appearance="outline" fxFlex="100">
                                    <textarea matInput formControlName="PacComments" #pacComments maxlength="150" style="resize: none;"></textarea>
                                    <!-- <span matInput class="input" role="textbox" contenteditable formControlName="PacComments" #pacComments maxlength="150" style="min-width: 500px; border: 1px solid #ccc;"></span>  -->
                                    <mat-hint align="end">{{pacComments.value?.length || 0}}/150</mat-hint>
                                 </mat-form-field>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <br/>
         <div fxLayout="column" fxFlex="1 1 100">
            <div fxFlex="1 1 100">
               <div fxLayout="column" fxFlex="1 1 100">
                  <div fxLayout="column" class="divBg">
                     <div fxFlex="1 1 100" fxLayout="column" fxLayoutGap="0px">
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="1px">
                           <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 34">
                                 <h2>TEST RESULTS</h2>
                              </div>
                           </div>
                        </div>
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="1px">
                           <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 20">
                                 <mat-label>Test Parameter</mat-label>
                              </div>
                              <div fxFlex="1 1 1">
                                 <mat-label>:</mat-label>
                              </div>
                              <div fxFlex="1 1 79">
                                 <input formControlName="Title" readonly disabled class="reportTxt" style="width: 400px;">
                              </div>
                           </div>
                        </div>
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="5px">
                           <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 20">
                                 <mat-label>Test Method</mat-label>
                              </div>
                              <div fxFlex="1 1 1">
                                 <mat-label>:</mat-label>
                              </div>
                              <div fxFlex="1 1 79">
                                 <input formControlName="Method" readonly disabled class="reportTxt" style="width: 300px;">
                              </div>
                           </div>
                        </div>
                        <br/>
                        <div fxFlex="100" fxLayout="row" fxLayout.xs="column" fxLayoutGap="5px">
                           <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">
                              <div fxFlex="1 1 100" fxLayout="row" class="div-outer-table">
                                 <table class="table" formArrayName="TestResults">
                                    <thead class="thead bg-info">
                                       <tr>
                                          <th>#</th>
                                          <th scope="col">SampleID</th>
                                          <th scope="col" class="text-center">
                                       <tr>
                                          <th scope="col">#</th>
                                          <th scope="col" style="width:122px">Parameter<label style="color:red">*</label></th>
                                          <th scope="col" style="width:129px">TestResult<label style="color:red">*</label></th>
                                          <th scope="col" style="width:78px" *ngIf="requestInfo.Title.Code != 'CORC'">Unit<label style="color:red">*</label></th>
                                          <th scope="col" style="width:78px" *ngIf="requestInfo.Title.Code == 'CORC'">Hours</th>
                                          <th scope="col" style="width:78px">RL</th>
                                          <th scope="col" style="width:88px">LimitValue</th>
                                          <th scope="col" style="width:119px">ResComment</th>
                                          <th scope="col" hidden>Action</th>
                                       </tr>
                                       </th>
                                       <th scope="col" hidden>Action</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr *ngFor="let person of getPeople(TestParameter); let i=index"
                                          [formGroupName]="i">
                                          <td>{{i+1}}</td>
                                          <td><input formControlName="SampleID" style="width:125px" readonly disabled>
                                          </td>
                                          <td>
                                             <table class="table table-sm" formArrayName="Results">
                                                <tbody>
                                                   <tr *ngFor="let address of getAddress(person); let j=index"
                                                      [formGroupName]="j">
                                                      <td>
                                                         {{j+1}}
                                                      </td>
                                                      <td>
                                                         <input formControlName="Parameter" style="width:115px">
                                                      </td>
                                                      <td>
                                                         <input formControlName="TestResult" style="width:120px">
                                                      </td>

                                                      <td>
                                                         <input formControlName="Unit" style="width:70px">
                                                      </td>
                                                      <td>
                                                         <input formControlName="RL" style="width:70px">
                                                      </td>
                                                      <td>
                                                         <input formControlName="LimitValue" style="width:80px">
                                                      </td>
                                                      <td>
                                                         <input formControlName="ResComment" style="width:110px">
                                                      </td>
                                                      <td hidden>
                                                         <button class="btn btn-success" *ngIf="j<1"
                                                            (click)="addAddress(i)" type="button">+</button>
                                                         <button class="btn btn-danger" *ngIf="j>=1"
                                                            (click)="removeAddress(i, j)" type="button">-</button>
                                                      </td>
                                                   </tr>
                                                </tbody>
                                             </table>
                                          </td>
                                          <td hidden>
                                             <button class="btn btn-success" style="float:left;"
                                                (click)="addTestResults()" type="button">+</button>
                                             <button class="btn btn-danger" style="float:right;" *ngIf="i>=1"
                                                (click)="removeTestResults(i)" type="button">-</button>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div fxFlex="1 1 100" fxLayout="row" fxLayoutAlign="space-between start">* RL = Reporting Limit; *
                        ND = Not Detected (below Reporting Limit);</div>
                  </div>
               </div>
            </div>
         </div>
         <br/>
         <div fxLayout="column" fxFlex="1 1 100">
            <div fxFlex="1 1 100">
               <div fxLayout="column" fxFlex="1 1 100">
                  <div fxLayout="column" class="divBg">
                     <div fxLayout="row" fxFlex="1 1 100">
                        {{requestInfo.value | json}}
                     </div><script src="../../Style Library/JS/SPPeoplePicker.js" type="text/javascript"></script>
                     <div fxLayout="row" fxFlex="1 1 100" >
                        <ng-container *ngIf="(requestInfo.TestParameterStatus == 'PickedUp' || requestInfo.TestParameterStatus == 'AssignTo'); else pickOrSubmitBtn">
                           <button ng-show="showResultSubmitBtn" mat-button type="submit"
                                 class="mat-raised-button mat-primary btn" (click)="approveraction('ResultSubmit')" id="btnResultSubmit">Result
                                 Submit</button>

                           <!-- <button mat-button type="submit" class="mat-raised-button mat-primary btn"
                                 style="margin-left: 10px;" (click)="approveraction('AssignTo')" >Assign to</button> -->

                          
                        </ng-container>

                        <ng-template #pickOrSubmitBtn>
                           <button mat-button type="submit" class="mat-raised-button mat-primary btn"
                                 (click)="approveraction('PickedUp')" id="btnPickUpTask">Pick up Task</button>

                          
                        </ng-template>

                     </div>

                     <div fxLayout="row" fxFlex="1 1 100" >
                        <script src="https://portal.bergerbd.com/Style Library/JS/SPPeoplePicker.js" type="text/javascript"></script>
                        <div id='reAssignedPersonpeoplepicker'><div id='reAssignedPersonpeoplepickerDiv'></div></div>
                        <!-- <button mat-button type="submit" class="mat-raised-button mat-primary btn"
                                 style="margin-left: 10px;" (click)="approveraction('AssignTo')" >Assign to</button> -->

                     </div>
                  </div>
               </div>
            </div>
         </div>
         <br/>
      </form>
   </div>
</div>

<br/>
<br/>